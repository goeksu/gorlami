<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <title>Gorlami Mobile</title>
  <style>
    html,body {
      margin: 0; padding: 0;
      height: 100%;
      overflow: hidden;
      background: #f7f7f7;
      touch-action: none;
    }
    canvas {
      display: block;
      width: 100%;
      height: 100%;
      background: linear-gradient(#f7f7f7,#eaeaea);
    }
  </style>
</head>
<body>
<canvas id="game"></canvas>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const DPR = window.devicePixelRatio || 1;

  let W = window.innerWidth;
  let H = window.innerHeight;

  function resize() {
    W = window.innerWidth;
    H = window.innerHeight;
    canvas.width = W * DPR;
    canvas.height = H * DPR;
    ctx.scale(DPR, DPR);
  }
  resize();
  window.addEventListener('resize', resize);

  // Game state
  let running = false;
  let frame = 0;
  let speed = 6;
  let score = 0;
  let highScore = Number(localStorage.getItem('gorlami_high') || 0);

  // Dino setup (ölçekli)
  const dino = {
    x: W * 0.1,
    y: 0,
    w: W * 0.08,
    h: H * 0.12,
    vy: 0,
    gravity: H * 0.0015,
    jumpForce: -H * 0.03,
    grounded: true
  };
  const groundY = H * 0.9;
  const obstacles = [];
  let spawnTimer = 0;
  let spawnInterval = 90;

  function reset() {
    running = true;
    frame = 0;
    speed = 6;
    score = 0;
    obstacles.length = 0;
    dino.y = groundY - dino.h;
    dino.vy = 0;
    dino.grounded = true;
  }

  function jump() {
    if (!running) { reset(); return; }
    if (dino.grounded) {
      dino.vy = dino.jumpForce;
      dino.grounded = false;
    }
  }

  // Touch and click for jump
  canvas.addEventListener('touchstart', (e) => { e.preventDefault(); jump(); }, {passive:false});
  canvas.addEventListener('mousedown', (e) => { e.preventDefault(); jump(); });

  function spawnObstacle() {
    const h = H * (0.05 + Math.random() * 0.07);
    const w = W * (0.03 + Math.random() * 0.05);
    obstacles.push({x: W + 20, y: groundY - h, w, h});
  }

  function update() {
    if (!running) return;
    frame++;
    if (frame % 240 === 0) speed += 0.5;

    dino.vy += dino.gravity;
    dino.y += dino.vy;
    if (dino.y + dino.h >= groundY) {
      dino.y = groundY - dino.h;
      dino.vy = 0;
      dino.grounded = true;
    }

    for (let i = obstacles.length-1; i >= 0; i--) {
      obstacles[i].x -= speed;
      if (obstacles[i].x + obstacles[i].w < -50) obstacles.splice(i,1);
    }

    spawnTimer++;
    if (spawnTimer > spawnInterval) {
      spawnTimer = 0;
      spawnInterval = 70 + Math.floor(Math.random()*80) - Math.min(40, Math.floor(score/100));
      spawnObstacle();
    }

    if (frame % 5 === 0) score += 1;

    for (const o of obstacles) {
      if (rectIntersect(dino, o)) {
        gameOver();
      }
    }
  }

  function rectIntersect(a,b){
    return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
  }

  function gameOver() {
    running = false;
    if (score > highScore) {
      highScore = score;
      localStorage.setItem('gorlami_high', highScore);
    }
  }

  function draw() {
    ctx.clearRect(0,0,W,H);

    // Ground
    ctx.fillStyle = '#797979';
    ctx.fillRect(0, groundY, W, H - groundY);

    // Dino
    ctx.fillStyle = '#222';
    ctx.fillRect(dino.x, dino.y, dino.w, dino.h);
    ctx.fillStyle = '#fff';
    ctx.fillRect(dino.x + dino.w - dino.w * 0.2, dino.y + dino.h * 0.2, dino.w * 0.1, dino.w * 0.1);

    // Obstacles
    for (const o of obstacles) {
      ctx.fillStyle = '#444';
      ctx.fillRect(o.x, o.y, o.w, o.h);
    }

    // Score
    ctx.fillStyle = '#222';
    ctx.font = `${Math.floor(H*0.03)}px monospace`;
    ctx.fillText('Skor: ' + score, 20, 40);
    ctx.fillText('En iyi: ' + highScore, 20, 80);

    if (!running) {
      ctx.fillStyle = 'rgba(255,255,255,0.85)';
      ctx.fillRect(W*0.1, H*0.4, W*0.8, H*0.15);
      ctx.fillStyle = '#222';
      ctx.font = `${Math.floor(H*0.04)}px sans-serif`;
      ctx.fillText('Başlamak için ekrana dokun', W*0.15, H*0.48);
    }
  }

  function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
  }

  reset();
  loop();
})();
</script>
</body>
</html>
